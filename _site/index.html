<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Analytics Playbook - Analytics Playbook</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="alternate" type="application/rss+xml" title="My Site RSS" href="/feed.xml" />
	<meta name="google-site-verification" content="jb8G-OKpGcofrmBS1UMKipsicRCLsh6qlYqI8vfi_6s" />
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- styles -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <style>
      body { padding-top: 60px; /* 60px to make the container go all the way
      to the bottom of the topbar */ }
    </style>
    <link href="/assets/css/custom.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
    <!-- fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/ico/apple-touch-icon-57-precomposed.png">
    <!-- Adobe DTM Library -->
    <script src="//assets.adobedtm.com/0cc0e010ce8e1e1377a4055fc7a51f61b47d14dc/satelliteLib-365bfb734a97fe5729197abcd7095108eec22654.js"></script>
	<script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74213600-1', 'auto');
      ga('require', 'linkid')
      ga('send', 'pageview');
    </script>
  </head>
	<body class="default-page">
    <div class="container">
				<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header">

					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						 <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
					</button>
					<a href="/" class="navbar-brand">Analytics Playbook</a>
				</div>

				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav navbar-right">
						<li>
							<a href="/search.html">Search</a>
						</li>
						<li>
							<a href="/how_to_submit.html">How To Submit An Article</a>
						</li>
						<li>
							<a href="/about.html">About</a>
						</li>
						<li>
							<a href="https://github.com/digitalanalyticscookbook/digitalanalyticscookbook.github.io" target="_blank">Fork This!</a>
						</li>
						<li>
							<a href="/feed.xml"><img src="/images/feed-icon-14x14.png" title="RSS Feed" alt="RSS Feed" /></a>
						</li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="row">
			<div class="col-md-3">
						
				<div class="panel-group" id="panel-testing">
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-testing" href="#testing">testing</a>
						</div>
						<div id="testing" class="panel-collapse collapse">
							<div class="panel-body">
								
									
									  
									
								
									
									  
										<li data-section='/testing/target_class_workflow.html'><a href='/testing/target_class_workflow.html'>Adobe Target - Classic Workflow</a></li>
									  
									
									  
										<li data-section='/testing/intro_to_ab_testing.html'><a href='/testing/intro_to_ab_testing.html'>Introduction to AB Testing and P-Values</a></li>
									  
									
									  
										<li data-section='/testing/conductrics_setup_abtest_intro.html'><a href='/testing/conductrics_setup_abtest_intro.html'>Conductrics - Intro to Page Editing for Simple A-B Testing</a></li>
									  
									
								
							</div>
						</div>
					</div>
				</div>
			
				<div class="panel-group" id="panel-tagmanagement">
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-tagmanagement" href="#tagmanagement">tagmanagement</a>
						</div>
						<div id="tagmanagement" class="panel-collapse collapse">
							<div class="panel-body">
								
									
									  
									
								
									
									  
										<li data-section='/tagmanagement/adobe_dtm_previous_page_name.html'><a href='/tagmanagement/adobe_dtm_previous_page_name.html'>Adobe DTM - Previous Page Name</a></li>
									  
									
									  
										<li data-section='/tagmanagement/adobe_dtm_console_messages.html'><a href='/tagmanagement/adobe_dtm_console_messages.html'>Adobe DTM - Using Browser Console Messages</a></li>
									  
									
									  
										<li data-section='/tagmanagement/set_record_visitors_type_adobe_dtm.html'><a href='/tagmanagement/set_record_visitors_type_adobe_dtm.html'>Adobe DTM - Set and Record Visitor type</a></li>
									  
									
									  
										<li data-section='/tagmanagement/json_datalayer_w3c_based.html'><a href='/tagmanagement/json_datalayer_w3c_based.html'>JSON Data Layer based on W3C norm</a></li>
									  
									
								
							</div>
						</div>
					</div>
				</div>
			
				<div class="panel-group" id="panel-api">
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-api" href="#api">api</a>
						</div>
						<div id="api" class="panel-collapse collapse">
							<div class="panel-body">
								
									
									  
									
								
									
									  
										<li data-section='/api/stattleship.html'><a href='/api/stattleship.html'>Stop Scraping - Analyzing Sports Data Using Stattleship</a></li>
									  
									
									  
										<li data-section='/api/python_groupby.html'><a href='/api/python_groupby.html'>Aggregate Sales Data using Python</a></li>
									  
									
									  
										<li data-section='/api/real-time-adobe-analytics-api-tutorial.html'><a href='/api/real-time-adobe-analytics-api-tutorial.html'>Real-Time Reporting Adobe Analytics API Tutorial</a></li>
									  
									
									  
										<li data-section='/api/python_identify_duplicate_data.html'><a href='/api/python_identify_duplicate_data.html'>Identifying Duplicate Sales Data using Python</a></li>
									  
									
									  
										<li data-section='/api/learn_sql_30_minutes.html'><a href='/api/learn_sql_30_minutes.html'>Learn SQL in 30 Minutes Using R and sqldf</a></li>
									  
									
								
							</div>
						</div>
					</div>
				</div>
			
				<div class="panel-group" id="panel-dataviz">
					<div class="panel panel-default">
						<div class="panel-heading">
							 <a class="panel-title" data-toggle="collapse" data-parent="#panel-dataviz" href="#dataviz">dataviz</a>
						</div>
						<div id="dataviz" class="panel-collapse collapse">
							<div class="panel-body">
								
									
									  
									
								
									
									  
										<li data-section='/dataviz/dashboard.html'><a href='/dataviz/dashboard.html'>Creating Interactive Dashboards in R</a></li>
									  
									
									  
										<li data-section='/dataviz/bar_charts.html'><a href='/dataviz/bar_charts.html'>Making Great Bar Charts In R</a></li>
									  
									
									  
										<li data-section='/dataviz/statebin.html'><a href='/dataviz/statebin.html'>Visualizing State Level Data With R and Statebins</a></li>
									  
									
								
							</div>
						</div>
					</div>
				</div>
			
			</div>
			<div class="col-md-9">
				<!-- This loops through the paginated posts -->

<h1 class="entry-title">

    <a href="/dataviz/dashboard.html">Creating Interactive Dashboards in R</a>

</h1>
  <div id="meta-content">
      <div class="post-meta small">
          Jowanza Joseph &times; <a href="/index.html">May 16, 2016</a> &times; dataviz
      </div>
  </div>
  <div class="content">
    <h3 id="problem">Problem</h3>

<p>Once painstakingly collected, data is most value when actionable steps are taken from it. Methods of safely distributing and communicating results from data are not all created equally. Dashboards are a safe and effective way to communicate results from data.</p>

<h3 id="actions">Actions</h3>

<p>We’ll walk through an example of how to create a dashboard in R using <em>flexdashboard</em>, an R framework for creating dashboards with R and Markdown.</p>

<h3 id="example">Example</h3>

<p>For this example we’ll grab data from Google Analytics and use it to make 3 charts on a dashboard.</p>

<ol>
  <li>A histogram</li>
  <li>A time series chart</li>
  <li>Sortable table</li>
</ol>

<p>To get this all to work, we’ll need to wrap our code in a flexdashboard template. You can find out how to do that <a href="http://rmarkdown.rstudio.com/flexdashboard/">here</a>. We’ll use the row template to get our charts displaying well on the page and allow for vertical scrolling.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">---</span>
title<span class="o">:</span> <span class="s">&quot;My Google Analytics Dashboard&quot;</span>
output<span class="o">:</span> 
  flexdashboard<span class="o">::</span>flex_dashboard<span class="o">:</span>
    orientation<span class="o">:</span> rows
    vertical_layout<span class="o">:</span> scroll
<span class="o">---</span></code></pre></div>

<p>For chart 1 we’ll use DT, a data table library to create a searchable and sortable table for our dashboard. I used data from the in-market segment in Google Analytics. Plotting the chart with default stylings is easy:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">datatable<span class="p">(</span>my_data_table<span class="p">)</span></code></pre></div>

<p>Chart 2 will be our histogram. The code for creating a histogram in Highcharter is very simple as well:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">hchart<span class="p">(</span>dataset<span class="o">$</span>Sessions<span class="p">,</span> color <span class="o">=</span> <span class="s">&quot;#B71C1C&quot;</span><span class="p">,</span> name <span class="o">=</span> <span class="s">&quot;Sessions&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  hc_title<span class="p">(</span>text <span class="o">=</span> <span class="s">&quot;Sessions May 2015 - May 2016&quot;</span><span class="p">)</span></code></pre></div>

<p>This should plot a histogram of traffic to my website from May 2015 through May 2016.  This chart is also zoomable, which is a nice feature to get for free.</p>

<p>Chart 3 is a time series chart. I will also use Highcharter for this as well:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">highchart<span class="p">()</span> <span class="o">%&gt;%</span>
  hc_add_series_times_values<span class="p">(</span><span class="kp">as.Date</span><span class="p">(</span>dataset<span class="o">$</span>Day.Index<span class="p">)</span> <span class="p">,</span> dataset<span class="o">$</span>Sessions<span class="p">,</span> name <span class="o">=</span> <span class="s">&quot;Sessions&quot;</span><span class="p">)</span></code></pre></div>

<p>This gives us visits by time over the same range.</p>

<p>From here you can click “Knit” in Rstudio and it will compile this markdown document into HTML. You will have a working, interactive and responsive dashboard. I’ve published a working version to rPubs for reference <a href="http://rpubs.com/josep2/example-ga-dashboard">here</a>.</p>

<p><img src="http://i.imgur.com/FvPLUmS.png" alt="image" /></p>

<h3 id="references">References</h3>

<ul>
  <li><a href="http://rmarkdown.rstudio.com/flexdashboard/index.html">flexdashboard</a></li>
  <li><a href="http://jkunst.com/highcharter/index.html">highcharter</a></li>
  <li><a href="">datatable</a></li>
  <li><a href="http://rstudio.github.io/DT/">DT</a></li>
</ul>

    <hr>
  </div>

<h1 class="entry-title">

    <a href="/api/stattleship.html">Stop Scraping - Analyzing Sports Data Using Stattleship</a>

</h1>
  <div id="meta-content">
      <div class="post-meta small">
          Tanya Cashorali &times; <a href="/index.html">April 20, 2016</a> &times; api
      </div>
  </div>
  <div class="content">
    <h3 id="problem">Problem</h3>

<p>You love sports. You love data. If you’ve ever gone on an epic journey in search of sports data, you’ve probably resorted to scraping data from sites like <a href="www.ESPN.com">ESPN</a> or <a href="http://www.baseball-reference.com/">Baseball Reference</a> and have spent countless hours writing Python code to use the powerful web scraping library <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>. Maybe you even have a nice <a href="https://github.com/seemethere/nba_py">Python client</a> that scrapes <a href="http://stats.nba.com">stats.nba.com</a> or you wrote an <a href="https://github.com/BillPetti/baseballr">R package</a> to scrape Baseball Reference.</p>

<p>However, we all know that websites get redesigned, formats change and sometimes access to specific stats is revoked (e.g. the NBA did this with <a href="http://stats.nba.com/help/whatsnew/">player movement tracking</a> but attributes it to ‘technical difficulties’). Suddenly, you are scrambling to update your scraping code in order to account for a few new divs or other elements on the web page that were renamed.</p>

<h3 id="actions">Actions</h3>
<p>This is where the Stattleship API comes to the rescue. We’ve built an easy-to-access set of sports data, stats and accomplishments for multiple sports (and expanding). We’ve partnered with Gracenote to provide all of our NFL, NBA, NHL and MLB game data. Our service is designed for creative fans who want to use Stattleship data to build sports apps that scale.</p>

<p>We’ve cleaned, structured, and categorized all of the box score, player stats and game log data for you. We’ve even quantified specific performances and feats so that you can quickly identify whether a stat is a common-place occurrence or a record-breaking achievement.</p>

<p>In this tutorial, we will show you how to use our R wrapper to access live and up-to-date sports data via the Stattleship API. There is also a Ruby gem for all of you Rubyists: <a href="https://github.com/stattleship/stattleship-ruby">https://github.com/stattleship/stattleship-ruby</a></p>

<h3 id="example">Example</h3>
<p>There are a few main endpoints that we will focus on. They are as follows:</p>

<ul>
  <li><b>games</b> - <i>contains game information such as date, attendance, scoreline, etc.</i></li>
  <li><b>players</b>- <i>contains player information such as name, position, draft round, school, salary, weight, birthday, etc.</i></li>
  <li><b>teams</b> - <i>contains team information such as name, division, colors, hashtags, etc.</i></li>
  <li><b>game_logs</b> - <i>contains player-level game log information such as Kevin Durant’s assists from a specific game, total minutes played, etc.</i></li>
  <li><b>team_game_logs</b> - <i>contains team-level game log information such as total points, rebounds and turnovers by the Boston Celtics in a specific game</i></li>
</ul>

<p>Here’s a basic Entity-Relationship Diagram outlining how these objects relate to one another:</p>

<p><img src="/images/stattleship_erd.png" alt="" /></p>

<p>In order to get started, sign up for a free API token from <a href="https://www.stattleship.com">here</a>. Now load up <a href="https://www.rstudio.com/">RStudio</a> and start following along! The first few lines of this R script will install the <a href="https://github.com/stattleship/stattleship-r">R package</a> from Github to your machine:</p>

<p>(If you don’t have <code>devtools</code> installed you will have to install that first.)</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&quot;stattleship/stattleship-r&quot;</span><span class="p">)</span>

<span class="c1">## Load the stattleshipR package</span>
<span class="kn">library</span><span class="p">(</span>stattleshipR<span class="p">)</span></code></pre></div>

<p>Next you need to set your API token in the R environment:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Get your free token from www.stattleship.com</span>
set_token<span class="p">(</span><span class="s">&quot;your-API-token-goes-here&quot;</span><span class="p">)</span></code></pre></div>

<p>Now we need to specify the sport, league and endpoint we are interested in. In this case we will fetch all MLB regular season game logs for the Red Sox to date. This is as easy as setting three parameters: <code>sport</code>, <code>league</code> and <code>ep</code> for endpoint.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">sport <span class="o">&lt;-</span> <span class="s">&#39;baseball&#39;</span>
league <span class="o">&lt;-</span> <span class="s">&#39;mlb&#39;</span>
ep <span class="o">&lt;-</span> <span class="s">&#39;game_logs&#39;</span></code></pre></div>

<p>This last parameter, called <code>q_body</code> is where we can set more granular options such as requesting a specific team, stat, player or season.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">q_body <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>team_id<span class="o">=</span><span class="s">&#39;mlb-bos&#39;</span><span class="p">,</span> status<span class="o">=</span><span class="s">&#39;ended&#39;</span><span class="p">,</span> interval_type<span class="o">=</span><span class="s">&#39;regularseason&#39;</span><span class="p">)</span></code></pre></div>

<p>Now that all of our parameters are set, we can use <code>ss_get_result</code> to send our request to the Stattleship API. Notice the <code>walk=TRUE</code> option. This ensures that the request will walk through all pages of results and return everything. Results are returned 40 rows per page.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">gls <span class="o">&lt;-</span> ss_get_result<span class="p">(</span>sport<span class="o">=</span>sport<span class="p">,</span> league<span class="o">=</span>league<span class="p">,</span> ep<span class="o">=</span>ep<span class="p">,</span> query<span class="o">=</span>q_body<span class="p">,</span> walk<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></code></pre></div>

<p>We now have a list in R that has 5 elements (there were 5 pages of results returned).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span> <span class="kp">length</span><span class="p">(</span>gls<span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">5</span></code></pre></div>

<p>We want to combine all of the pages of results into one <code>data.frame</code>:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">game_logs<span class="o">&lt;-</span><span class="kp">do.call</span><span class="p">(</span><span class="s">&#39;rbind&#39;</span><span class="p">,</span> <span class="kp">lapply</span><span class="p">(</span>gls<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> x<span class="o">$</span>game_logs<span class="p">))</span></code></pre></div>

<p>Let’s check out all of the data we now have access to from yesterday’s games:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">colnames</span><span class="p">(</span>game_logs<span class="p">)</span></code></pre></div>

<p><img src="/images/Screen-Shot-2016-04-19-at-2-52-14-PM-1.png" alt="" /></p>

<p>Wow, over 80 variables for each player including strikeouts, walks, doubles, runs, and more.</p>

<p>I want to include player information into this data set though so I have more than just <code>player_ids</code>. Let’s retrieve all Boston Red Sox players by changing the <code>ep</code> to <code>players</code> and pass <code>team_id='mlb-bos</code> into the options list.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">sport <span class="o">&lt;-</span> <span class="s">&#39;baseball&#39;</span>  
league <span class="o">&lt;-</span> <span class="s">&#39;mlb&#39;</span>  
ep <span class="o">&lt;-</span> <span class="s">&#39;players&#39;</span>  
q_body <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>team_id<span class="o">=</span><span class="s">&#39;mlb-bos&#39;</span><span class="p">)</span>

pls <span class="o">&lt;-</span> ss_get_result<span class="p">(</span>sport<span class="o">=</span>sport<span class="p">,</span> league<span class="o">=</span>league<span class="p">,</span> ep<span class="o">=</span>ep<span class="p">,</span> query<span class="o">=</span>q_body<span class="p">,</span> walk<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>  
players<span class="o">&lt;-</span><span class="kp">do.call</span><span class="p">(</span><span class="s">&#39;rbind&#39;</span><span class="p">,</span> <span class="kp">lapply</span><span class="p">(</span>pls<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> x<span class="o">$</span>players<span class="p">))</span></code></pre></div>

<p>In order to merge the two data.frames we can simply rename the <code>id</code> column to <code>player_id</code> so we can use <code>merge</code> in R like this:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">colnames</span><span class="p">(</span>players<span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&#39;player_id&#39;</span>
game_logs <span class="o">&lt;-</span> <span class="kp">merge</span><span class="p">(</span>players<span class="p">,</span> game_logs<span class="p">,</span> by<span class="o">=</span><span class="s">&#39;player_id&#39;</span><span class="p">)</span></code></pre></div>

<p>Now let’s do some basic player calculations using <code>dplyr</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&#39;dplyr&#39;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>

<span class="c1">## Only include game_logs where a player actually played the game, calculate mean batting average,</span>
<span class="c1">## total runs, total bases and pull in salary info</span>
stats <span class="o">&lt;-</span>
  game_logs <span class="o">%&gt;%</span>
  filter<span class="p">(</span>game_played <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
  group_by<span class="p">(</span>name<span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>totalRuns <span class="o">=</span> <span class="kp">sum</span><span class="p">(</span>runs<span class="p">),</span> meanBA <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>batting_average<span class="p">),</span> totalBases<span class="o">=</span><span class="kp">sum</span><span class="p">(</span>total_bases<span class="p">),</span> salary<span class="o">=</span><span class="kp">max</span><span class="p">(</span>salary<span class="p">))</span></code></pre></div>

<p><img src="/images/Screen-Shot-2016-04-19-at-3-24-14-PM.png" alt="" /></p>

<p>Good! Now let’s plot it all using <code>ggplot2</code>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ggplot<span class="p">(</span>stats<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>totalRuns<span class="p">,</span> y<span class="o">=</span>meanBA<span class="p">,</span> size<span class="o">=</span>totalBases<span class="p">,</span> label<span class="o">=</span>name<span class="p">,</span> color<span class="o">=</span>salary<span class="p">))</span> <span class="o">+</span> geom_text<span class="p">()</span></code></pre></div>

<p>This plot actually enables us to visualize 4 different variables at once. The x and y axes display total runs and mean batting average, the size of the labels indicate how many total bases the player has had, and the color indicates salary. Xander Bogaerts and Travis Shaw are looking like quite a bargain at this point in the season already.
<img src="/images/redsox.png" alt="" /></p>

<p>Let us know if you build anything cool with this awesome sports data API! We also welcome contributions to our R wrapper via <a href="https://github.com/stattleship/stattleship-r">pull requests in Github</a>. We have a <a href="https://fanboat.stattleship.com/">public Slack channel</a> as well where you can join us to talk sports, data, get R or Stattleship API help, and provide feedback.</p>

<h3 id="references--other-examples">References / Other Examples</h3>

<ul>
  <li><a href="https://gist.github.com/tcash21/3a3b103386e1115aee6aa6ea6add072a">Full R script from this post</a></li>
  <li><a href="developers.stattleship.com">Stattleship API documentation</a></li>
  <li><a href="https://oglethorpe.stattleship.com/photos?photo_type=CurrentWinningStreakPhoto">Oglethorpe, stat infographics otherwise known as StatShots</a></li>
  <li><a href="http://104.131.198.150:3838/statship-app/">NFL Yardage by Team 2015</a></li>
  <li><a href="https://tcb-analytics.shinyapps.io/dfsoptimize/">Fanduel NBA Optimizer</a></li>
  <li><a href="https://github.com/stattleship/glickman">Glickman Statmoji slackbot</a></li>
  <li><a href="http://blog.stattleship.com">Stattleship Blog</a></li>
</ul>

    <hr>
  </div>

<h1 class="entry-title">

    <a href="/dataviz/bar_charts.html">Making Great Bar Charts In R</a>

</h1>
  <div id="meta-content">
      <div class="post-meta small">
          Jowanza Joseph &times; <a href="/index.html">April 11, 2016</a> &times; dataviz
      </div>
  </div>
  <div class="content">
    <h3 id="problem">Problem</h3>
<p>As data collection and aggregation grows in an organization, presenting and consuming that data can become a real challenge. A good foundation in visualization eases this burden. Using bar charts effectively can help with sw</p>

<h3 id="actions">Actions</h3>
<p>We will walk through an example of how to create a useful and beautiful barchart in R.</p>

<h3 id="example">Example</h3>

<p>In R, the library ggplot2 is your best friend when it comes to creatingstatic bar charts. You can create a simple one with the following code:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

ggplot<span class="p">(</span>mpg<span class="p">,</span> aes<span class="p">(</span><span class="kp">class</span><span class="p">,</span> fill <span class="o">=</span> <span class="kp">class</span><span class="p">))</span> <span class="o">+</span> geom_bar<span class="p">()</span></code></pre></div>

<p><img src="http://i.imgur.com/ZPrONaq.png" alt="image" /></p>

<p>This bar chart is simple and effect but we can do better. We can start simple by adding titles.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ggplot<span class="p">(</span>mpg<span class="p">,</span> aes<span class="p">(</span><span class="kp">class</span><span class="p">,</span> fill <span class="o">=</span> <span class="kp">class</span><span class="p">))</span> <span class="o">+</span> geom_bar<span class="p">()</span> <span class="o">+</span>
  labs<span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;Count of Car Classes MPG Dataset&quot;</span><span class="p">,</span> x <span class="o">=</span> <span class="s">&quot;Car Class&quot;</span><span class="p">,</span> y <span class="o">=</span> <span class="s">&quot;Count&quot;</span><span class="p">)</span></code></pre></div>

<p><img src="http://i.imgur.com/56OPrfU.png" alt="image" /></p>

<p>The background space in this chart isn’t really pleasing to the eyes. We can make a customize the chart and make it all grey for effect:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>scales<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>grid<span class="p">)</span> 
<span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>extrafont<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>reshape<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggthemes<span class="p">)</span>

blogData <span class="o">=</span> mpg

palette <span class="o">&lt;-</span> brewer.pal<span class="p">(</span><span class="s">&quot;Greys&quot;</span><span class="p">,</span> n<span class="o">=</span><span class="m">9</span><span class="p">)</span>
color.background <span class="o">=</span> palette<span class="p">[</span><span class="m">2</span><span class="p">]</span>

ggplot<span class="p">(</span>mpg<span class="p">,</span> aes<span class="p">(</span><span class="kp">class</span><span class="p">,</span> fill <span class="o">=</span> <span class="kp">class</span><span class="p">))</span> <span class="o">+</span> geom_bar<span class="p">()</span> <span class="o">+</span>
  labs<span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;Count of Car Classes MPG Dataset&quot;</span><span class="p">,</span> x <span class="o">=</span> <span class="s">&quot;Car Class&quot;</span><span class="p">,</span> y <span class="o">=</span> <span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="o">+</span>
  theme_bw<span class="p">(</span>base_size<span class="o">=</span><span class="m">9</span><span class="p">)</span><span class="o">+</span>
  theme<span class="p">(</span>panel.background<span class="o">=</span>element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">,</span> color<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
  theme<span class="p">(</span>plot.background<span class="o">=</span>element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">,</span> color<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
  theme<span class="p">(</span>panel.border<span class="o">=</span>element_rect<span class="p">(</span>color<span class="o">=</span>color.background<span class="p">))</span><span class="o">+</span>
  theme<span class="p">(</span>legend.background <span class="o">=</span> element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">))</span></code></pre></div>

<p><img src="https://i.imgur.com/dQ3YlQZ.png" alt="image" /></p>

<p>A few more modifications can be made.</p>

<ol>
  <li>Sort by count</li>
  <li>Flip the axis</li>
  <li>Overlay the count</li>
  <li>Change the font of the chart</li>
  <li>Change the opacity of the bars</li>
  <li>Remove the legend (doesn’t add any value)</li>
  <li>Some other aesthetic fixes</li>
</ol>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>scales<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>grid<span class="p">)</span> 
<span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>extrafont<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>reshape<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggthemes<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>

blogData <span class="o">=</span> mpg

palette <span class="o">&lt;-</span> brewer.pal<span class="p">(</span><span class="s">&quot;Greys&quot;</span><span class="p">,</span> n<span class="o">=</span><span class="m">9</span><span class="p">)</span>
color.background <span class="o">=</span> palette<span class="p">[</span><span class="m">2</span><span class="p">]</span>

newMPG <span class="o">&lt;-</span> group_by<span class="p">(</span>mpg<span class="p">,</span><span class="kp">class</span><span class="p">)</span> <span class="o">%&gt;%</span>
  summarise<span class="p">(</span>total <span class="o">=</span> n<span class="p">())</span> <span class="o">%&gt;%</span>
  arrange<span class="p">(</span>desc<span class="p">(</span>total<span class="p">))</span>

ggplot<span class="p">(</span>newMPG<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>reorder<span class="p">(</span><span class="kp">class</span><span class="p">,</span> <span class="o">+</span>total<span class="p">),</span> total<span class="p">))</span> <span class="o">+</span> coord_flip<span class="p">()</span><span class="o">+</span> geom_bar<span class="p">(</span>fill <span class="o">=</span> <span class="s">&quot;#6f00ff&quot;</span><span class="p">,</span> stat<span class="o">=</span><span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
  labs<span class="p">(</span>title <span class="o">=</span> <span class="s">&quot;Count of Car Classes&quot;</span><span class="p">,</span> x <span class="o">=</span> <span class="s">&quot;Car Class&quot;</span><span class="p">,</span> y <span class="o">=</span> <span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="o">+</span>
  geom_text<span class="p">(</span>aes<span class="p">(</span>y<span class="o">=</span>total <span class="o">-</span> <span class="m">1</span><span class="p">,</span> label<span class="o">=</span>total<span class="p">),</span> position <span class="o">=</span> position_dodge<span class="p">(</span><span class="m">.09</span><span class="p">),</span> vjust<span class="o">=</span> <span class="m">.5</span><span class="p">,</span> size <span class="o">=</span> <span class="m">3</span><span class="p">,</span> hjust <span class="o">=</span> <span class="m">1.3</span><span class="p">,</span> fontface<span class="o">=</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;Hack&quot;</span><span class="p">)</span><span class="o">+</span>
  my_theme<span class="p">()</span>
  
my_theme <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="c1"># Generate the colors for the chart procedurally with RColorBrewer</span>
  palette <span class="o">&lt;-</span> brewer.pal<span class="p">(</span><span class="s">&quot;Greys&quot;</span><span class="p">,</span> n<span class="o">=</span><span class="m">9</span><span class="p">)</span>
  color.background <span class="o">=</span> palette<span class="p">[</span><span class="m">2</span><span class="p">]</span>
  color.grid.major <span class="o">=</span> palette<span class="p">[</span><span class="m">3</span><span class="p">]</span>
  color.axis.text <span class="o">=</span> palette<span class="p">[</span><span class="m">6</span><span class="p">]</span>
  color.axis.title <span class="o">=</span> palette<span class="p">[</span><span class="m">7</span><span class="p">]</span>
  color.title <span class="o">=</span> palette<span class="p">[</span><span class="m">9</span><span class="p">]</span>
  
  <span class="c1"># Begin construction of chart</span>
  theme_bw<span class="p">(</span>base_size<span class="o">=</span><span class="m">9</span><span class="p">)</span> <span class="o">+</span>
    
    <span class="c1"># Set the entire chart region to a light gray color</span>
    theme<span class="p">(</span>panel.background<span class="o">=</span>element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">,</span> color<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>plot.background<span class="o">=</span>element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">,</span> color<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>panel.border<span class="o">=</span>element_rect<span class="p">(</span>color<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
    
    
    <span class="c1"># Format the grid</span>
    theme<span class="p">(</span>panel.grid.major<span class="o">=</span>element_line<span class="p">(</span>color<span class="o">=</span>color.grid.major<span class="p">,</span>size<span class="o">=</span><span class="m">.25</span><span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>panel.grid.minor<span class="o">=</span>element_blank<span class="p">())</span> <span class="o">+</span>
    theme<span class="p">(</span>axis.ticks<span class="o">=</span>element_blank<span class="p">())</span> <span class="o">+</span>
    
    
    <span class="c1"># Format the legend, but hide by default</span>
    theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span> <span class="o">+</span>
    theme<span class="p">(</span>legend.background <span class="o">=</span> element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>legend.text <span class="o">=</span> element_text<span class="p">(</span>size<span class="o">=</span><span class="m">7</span><span class="p">,</span>color<span class="o">=</span>color.axis.title<span class="p">))</span> <span class="o">+</span>
    
    
    <span class="c1"># Set title and axis labels, and format these and tick marks</span>
    theme<span class="p">(</span>plot.title<span class="o">=</span>element_text<span class="p">(</span>color<span class="o">=</span>color.title<span class="p">,</span> size<span class="o">=</span><span class="m">15</span><span class="p">,</span> vjust<span class="o">=</span><span class="m">1.25</span><span class="p">,</span>face<span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> family<span class="o">=</span><span class="s">&quot;Hack&quot;</span><span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>axis.text.x<span class="o">=</span>element_text<span class="p">(</span>size<span class="o">=</span><span class="m">10</span><span class="p">,</span>color<span class="o">=</span>color.axis.text<span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>axis.text.y<span class="o">=</span>element_text<span class="p">(</span>size<span class="o">=</span><span class="m">10</span><span class="p">,</span>color<span class="o">=</span>color.axis.text<span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>axis.title.x<span class="o">=</span>element_text<span class="p">(</span>size<span class="o">=</span><span class="m">10</span><span class="p">,</span>color<span class="o">=</span>color.axis.title<span class="p">,</span> vjust<span class="o">=</span><span class="m">0</span><span class="p">,</span> face<span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> family<span class="o">=</span> <span class="s">&quot;Hack&quot;</span><span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>axis.title.y<span class="o">=</span>element_text<span class="p">(</span>size<span class="o">=</span><span class="m">10</span><span class="p">,</span>color<span class="o">=</span>color.axis.title<span class="p">,</span> vjust<span class="o">=</span><span class="m">1.25</span><span class="p">,</span> face<span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;Hack&quot;</span><span class="p">))</span> <span class="o">+</span> 
    theme<span class="p">(</span>strip.text.y <span class="o">=</span> element_text<span class="p">(</span>size <span class="o">=</span> <span class="m">10</span><span class="p">,</span> colour <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span> face<span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;Hack&quot;</span><span class="p">))</span> <span class="o">+</span>
    theme<span class="p">(</span>strip.background <span class="o">=</span> element_rect<span class="p">(</span>fill<span class="o">=</span>color.background<span class="p">,</span> color<span class="o">=</span>color.background<span class="p">,</span> size<span class="o">=</span><span class="m">1</span><span class="p">))</span> <span class="o">+</span>
    
    <span class="c1"># Plot margins</span>
    theme<span class="p">(</span>plot.margin <span class="o">=</span> unit<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">0.35</span><span class="p">,</span> <span class="m">0.2</span><span class="p">,</span> <span class="m">0.3</span><span class="p">,</span> <span class="m">0.35</span><span class="p">),</span> <span class="s">&quot;cm&quot;</span><span class="p">))</span>
<span class="p">}</span></code></pre></div>

<p><img src="http://i.imgur.com/DOnynEA.png" alt="image" /></p>

<p>Now we have a chart worth sharing.</p>

<h3 id="references">References:</h3>

<p><a href="http://docs.ggplot2.org/current/">ggplot2</a></p>

<p><a href="http://minimaxir.com/2015/02/ggplot-tutorial/">Max Woolf</a></p>


    <hr>
  </div>


<!-- Pagination links -->

<div class="pagination">
  
    <span>&laquo; Prev</span>
  

  
    
       1
    
  
    
      <a href="/page2">2</a>
    
  
    
      <a href="/page3">3</a>
    
  
    
      <a href="/page4">4</a>
    
  
    
      <a href="/page5">5</a>
    
  

  
    <a href="/page2">Next &raquo;</a>
  
</div>


				<div id="tweet">
					<a href="https://twitter.com/share" class="twitter-share-button" data-via="APlaybookOrg" data-size="large" data-hashtags="measure">Tweet</a>
					<script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
				</div>
			</div>
		</div>
	</div>
    
		<!-- Latest jQuery Bootstrap JavaScript -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js">
    </script>
    <!-- Latest compiled and minified Bootstrap JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	
	<!--Adobe DTM Footer code-->
	<script type="text/javascript">_satellite.pageBottom();</script>
  </body>
</html>
